<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>GitHub Card Generator</title>
  <meta name="description"
    content="A fan-made generator for cards to display github repositories. Download your cards in PNG or copy the code to your website!">
  <meta name="author" content="immarianaas">
  <meta http-equiv="Permissions-Policy" content="interest-cohort=()">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-css.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.js"></script>


  <script type="module">
    import { Octokit } from "https://cdn.skypack.dev/@octokit/rest";

    function mapToData(data) {
      return {
        name: data.name,
        full_name: data.full_name,
        owner: {
          login: data.owner.login,
          avatar_url: data.owner.avatar_url,
          html_url: data.owner.html_url
        },
        html_url: data.html_url,
        description: data.description,
        stargazers_count: data.stargazers_count,
        watchers_count: data.watchers_count,
        topics: data.topics
      };
    }

    let octokit = new Octokit({});
    let owner = "immarianaas";

    let repo = "github-card-generator";



    function updateCard(owner, repo) {
      let answer = octokit.request('GET /repos/' + owner + '/' + repo, {
        owner: owner,
        repo: repo
      });

      let githubData;

      answer.then(result => {
        console.log(result);
        githubData = mapToData(result.data);
        console.log(githubData);

        let data = result.data;


        // document.getElementById('userLink').href = 'https://github.com/' + owner;
        // document.getElementById('cardLink').href = 'https://github.com/' + owner + '/' + repo;

        document.getElementById('owner').textContent = githubData.owner.login;
        document.getElementById('repo').textContent = githubData.name;
        document.getElementById('description').textContent = githubData.description;
        document.getElementById('owneravatar').src = githubData.owner.avatar_url;


        // cleanup topics
        document.getElementById('topics').innerHTML = "";
        let topicsLength = githubData.topics.length;
        for (let i = 0; i < topicsLength; i++) {
          // https://github.com/topics/
          let topic_code = '<span class="description topic" id="topic' + i + '"></span>\n';
          document.getElementById('topics').innerHTML += topic_code;
          document.getElementById('topic' + i).textContent = githubData.topics[i];
        }

        // reset additonal info
        document.getElementById('additionalinfo').innerHTML = "";

        /*
        if (data.has_wiki) {
          let wiki_code = '<div class="" id="has_wiki">README</div>';
          document.getElementById('additionalinfo').innerHTML += wiki_code;
        }
        */

        // adicionar languages

        if (data.license) {
          let licence_code = '<div class="" id="licence"></div>';
          document.getElementById('additionalinfo').innerHTML += licence_code;
          document.getElementById('licence').textContent = data.license.name;
        }

        let stargazers_url = 'https://github.com/' + owner + '/' + repo + '/stargazers';
        let watchers_url = 'https://github.com/' + owner + '/' + repo + '/watchers';
        let forks_url = 'https://github.com/' + owner + '/' + repo + '/network/members';

        document.getElementById('additionalinfo').innerHTML += '<div class=""><a target="_blank" href="' + stargazers_url + '"><b>' + data.stargazers_count + '</b> stargazers</a></div>\n';
        document.getElementById('additionalinfo').innerHTML += '<div class=""><a target="_blank" href="' + watchers_url + '"><b>' + data.watchers_count + '</b> watchers</a></div>\n';
        document.getElementById('additionalinfo').innerHTML += '<div class=""><a target="_blank" href="' + forks_url + '"><b>' + data.forks_count + '</b> forks</a></div>\n';


      });

    }


    window.onload = function () {

      updateCard(owner, repo);


      /*
      - readme      -> "has_wiki" ?
      - licence     -> "licence.name"
      - stars       -> "stargazers_count"
      - watching    -> "watchers_count"
      - forks       -> "forks_count"

      - languages   -> https://api.github.com/repos/immarianaas/c-quiz-language/languages

      - issues      -> "open_issues_count"
      - contributors  -> "collaborators_url" ... req. auth.
      */

    }

    function onSubmitForm() {

      let form = document.getElementById('form');
      let formData = new FormData(form);

      owner = formData.get('username').trim();
      repo = formData.get('repository').trim();

      updateCard(owner, repo);
    }

    function onClickCard() {
      window.open('https://github.com/' + owner + '/' + repo);
    }

    function onClickUser() {
      window.open('https://github.com/' + owner);
    }

    window.onSubmitForm = onSubmitForm;
    window.onClickCard = onClickCard;
    window.onClickUser = onClickUser;

  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
  <script type="module">
    import hljs from 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/es/highlight.min.js';
    hljs.highlightAll();

    const escapeHtml = (unsafe) => {
      return unsafe.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('"', '&quot;').replaceAll("'", '&#039;');
    }

    function genStaticHtml() {
      console.log('hey');
      let card = document.getElementById('card');

      console.log(card.outerHTML);

      let code = document.getElementById('staticcodeblock');

      const options = { indent_size: 2 }

      code.innerHTML = html_beautify(card.innerHTML, options);
      code.innerHTML = escapeHtml(code.outerHTML);

      hljs.highlightBlock(code);

    }


    window.genStaticHtml = genStaticHtml;
  </script>

  <script></script>

  <!-- Link to your JS file -->
  <script src="scripts/script.js"></script>

  <!-- Link to your CSS file -->
  <link rel="stylesheet" href="css/style.css">

</head>

<body>

  <!--

  <div class="widget versionTwo">

    <div class="header">

      <div class="inline">
        <div class="icon">
          <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="40px">
            <title>GitHub</title>
            <path
              d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" />
          </svg>
        </div>
        <div class="usernamePart">
          <div class="icon">
            <img id="owneravatar" width="40px" style="border-radius: 10px;">
          </div>
          <div class="username">
            <span class="" id="owner"></span>
          </div>
        </div>
      </div>


      <div class="repnameTwo inline">
        <span id="repo"></span>
      </div>

    </div>
    <p class="description" id="description"></p>

    <span id="topics">
    </span>

  </div>
-->


  <!------------------ FORM PART ------------------>
  <div class="form">


    <form id="form" action="" onsubmit="onSubmitForm(); return false">

      <div>
        <div><label for="username">Username:</label></div>
        <div><input class="textInput" type="text" name="username" id="username" value="" placeholder="immarianaas">
        </div>
      </div>

      <div style="margin-top: 30px;">
        <div><label for="repository">Repository name:</label></div>
        <div><input class="textInput" type="text" name="repository" id="repository" value=""
            placeholder="github-card-generator"></div>
      </div>

      <input class="submitBtn blue" type="submit" value="Generate card!" />

    </form>

  </div>




  <!------------------ CARD PART ------------------>
  <div class="cardsection">

    <div class="container">
      <div id="card" class="widget versionTwo" onclick="onClickCard()">
        <div class="header">
          <div class="inline">
            <div class="icon">
              <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="40px">
                <title>GitHub</title>
                <path
                  d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" />
              </svg>
            </div>
            <div class="usernamePart" onclick="onClickUser()">
              <div class="icon">
                <img id="owneravatar" width="40px" style="border-radius: 10px;">
              </div>
              <div class="username">
                <span id="owner"></span>
              </div>
            </div>
          </div>
          <div class="repnameTwo inline">
            <span id="repo"></span>
          </div>
        </div>
        <p class="description" id="description"></p>
        <span id="topics">
        </span>
        <div class="additional" id="additionalinfo">
        </div>
      </div>

      <div>
      </div>
      <button class="submitBtn pink" onclick="genStaticHtml()"> show static HTML code
      </button>

      <button class="submitBtn pink"> download PNG (TODO)
      </button>
    </div>




    <div class="codeBlock">

      <button class="copy ">copy to clipboard</button>
      <div style="display: block; height: 5px;"></div>

      <pre>
        <code class="html" id="staticcodeblock">

          <!-- &lt;html&gt; &lt;p&gt; hello world  &lt;/p&gt; &lt;/html&gt; -->
        </code>
      </pre>
    </div>

  </div>



</body>

</html>